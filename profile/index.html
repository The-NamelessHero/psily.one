<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Profile ‚Äì Psily.one</title>
  <link rel="stylesheet" href="../style.css">
  <style>
    body { font-family: Georgia, serif; background: #1a0f1f; color: #f8e1ff; margin:0; padding:1em; }
    header { text-align:center; margin-bottom:1em; }
    nav a { margin:0 1em; color:#b892ff; text-decoration:none; }
    .search { text-align:center; margin-bottom:2em; }
    .search input { padding:0.5em; width:200px; border-radius:6px; border:1px solid #774da9; background:#1e1127; color:#fff3ff; }
    .search button { padding:0.5em 1em; margin-left:0.5em; border:none; border-radius:6px; background:#774da9; color:#fff; cursor:pointer; }
    #scrolls { max-width:700px; margin:0 auto; }
    .scroll { background:#2d1b3a; border:2px solid #774da9; border-radius:8px; padding:1em; margin-bottom:1em; }
    .scroll p { margin:0.5em 0; }
    .scroll .author { font-size:0.9em; color:#cfaaff; }
  </style>
</head>
<body>

  <header>
    <nav>
      <a href="/">üåÄ Home</a>
      <a href="/scrolls/">‚úçÔ∏è Write a Scroll</a>
      <a href="/library/">üèõÔ∏è Library</a>
    </nav>
    <h1>Your Personal Archive</h1>
  </header>

  <div class="search">
    <input id="authorInput" type="text" placeholder="Enter a user name‚Ä¶">
    <button id="searchBtn">Search</button>
  </div>

  <section id="scrolls">
    <p style="text-align:center;color:#bbb;">Search for a user to see their scrolls.</p>
  </section>

  <script>
    const scrollsEl = document.getElementById('scrolls');
    const input = document.getElementById('authorInput');
    document.getElementById('searchBtn').onclick = () => {
      const author = input.value.trim();
      if (!author) return alert('Please enter a name.');
      loadScrollsFor(author);
    };

    // Auto-run if ?author=... is present
    const params = new URLSearchParams(location.search);
    if (params.has('author')) {
      const author = params.get('author');
      input.value = author;
      loadScrollsFor(author);
    }

    async function loadScrollsFor(author) {
      scrollsEl.innerHTML = '<p style="text-align:center;color:#bbb;">Loading scrolls‚Ä¶</p>';
      try {
        const res = await fetch('https://api.sheety.co/ac6a020fab729985f64a3f30b8b8763f/psily/scroll');
        const data = await res.json();
        const all = data.scroll || [];
        const filtered = all.filter(s => (s.author||'Anonymous').toLowerCase() === author.toLowerCase());
        if (filtered.length === 0) {
          scrollsEl.innerHTML = `<p style="text-align:center;color:#bbb;">No scrolls found for ‚Äú${author}.‚Äù</p>`;
          return;
        }
        // display them newest first
        scrollsEl.innerHTML = '';
        filtered.reverse().forEach(s => {
          const div = document.createElement('div');
          div.className = 'scroll';
          div.innerHTML = `
            <p>${s.scroll}</p>
            <div class="author">‚Äì ${s.author || 'Anonymous'}</div>
          `;
          scrollsEl.appendChild(div);
        });
      } catch (err) {
        scrollsEl.innerHTML = `<p style="text-align:center;color:#f88;">Failed to load. Try again later.</p>`;
        console.error(err);
      }
    }
  </script>

</body>
</html>
