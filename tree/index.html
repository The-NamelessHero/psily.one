<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tree of Love ‚Äì Psily.one</title>
  <link rel="stylesheet" href="../style.css">
  <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet" />
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <style>
    body {
      margin: 0; padding: 1em;
      background: #1a0f1f;
      color: #f8e1ff;
      font-family: Georgia, serif;
    }
    header { text-align: center; margin-bottom: 1em; }
    nav a, nav button {
      margin: 0 1em;
      color: #b892ff;
      text-decoration: none;
      background: none;
      border: none;
      font: inherit;
      cursor: pointer;
    }
    .controls {
      text-align: center;
      margin-bottom: 1em;
    }
    .controls input,
    .controls select,
    .controls button {
      padding: .5em;
      margin: 0 .5em;
      border-radius: 4px;
      border: 1px solid #774da9;
      background: #1e1127;
      color: #fff3ff;
      font: inherit;
    }
    #network {
      width: 100%;
      height: 75vh;
      border: 2px solid #774da9;
      border-radius: 8px;
      background: #2d1b3a;
    }
    footer {
      text-align: center;
      margin-top: 1em;
    }
    footer a {
      color: #b892ff;
      text-decoration: none;
    }
  </style>
</head>
<body>

  <header>
    <nav>
      <a href="/">üåÄ Home</a>
      <a href="/scrolls/">‚úçÔ∏è Write a Scroll</a>
      <a href="/library/">üèõÔ∏è Library</a>
      <a href="/profile/">üë§ Profile</a>
      <button onclick="toggleDark()">üåì</button>
    </nav>
    <h1>üå≥ Tree of Love</h1>
    <p>Blank slate: add people and link them however you like.</p>
  </header>

  <div class="controls">
    <input id="nameA" placeholder="Name A" />
    <select id="relationType">
      <option value="parent">üë™ Parent link</option>
      <option value="child">üë∂ Child link</option>
      <option value="love">‚ù§Ô∏è Love/friend link</option>
    </select>
    <input id="nameB" placeholder="Name B" />
    <button onclick="addRelation()">Add Relation</button>
  </div>

  <div id="network"></div>

  <footer>
    <a href="/">‚Üê Back to Psily.one</a>
  </footer>

  <script>
    // Toggle light/dark
    function toggleDark() {
      document.body.classList.toggle('light-mode');
    }

    // 1) Start with empty datasets
    const nodes = new vis.DataSet([]);
    const edges = new vis.DataSet([]);

    // 2) Initialize the network
    const container = document.getElementById('network');
    const data = { nodes, edges };
    const options = {
      nodes: {
        shape: 'box',
        margin: 10,
        widthConstraint: { maximum: 200 }
      },
      layout: {
        hierarchical: {
          enabled: true,
          direction: 'UD',
          sortMethod: 'directed',
          nodeSpacing: 200,
          levelSeparation: 150
        }
      },
      interaction: {
        dragNodes: true,
        dragView: true,
        zoomView: true
      },
      physics: { enabled: false }
    };
    const network = new vis.Network(container, data, options);

    // 3) Helper to find-or-create a node by label
    function getNodeId(label) {
      // try existing
      const found = nodes.get({ filter: n => n.label === label })[0];
      if (found) return found.id;
      // else create new
      const newId = nodes.length === 0
        ? 1
        : Math.max(...nodes.get().map(n => n.id)) + 1;
      nodes.add({ id: newId, label });
      return newId;
    }

    // 4) Add a new relation (and nodes if needed)
    function addRelation() {
      const A = document.getElementById('nameA').value.trim();
      const B = document.getElementById('nameB').value.trim();
      const type = document.getElementById('relationType').value;
      if (!A || !B) {
        return alert('Please enter both names.');
      }

      const idA = getNodeId(A);
      const idB = getNodeId(B);

      let edgeConfig;
      if (type === 'child') {
        // Child link: solid grey
        edgeConfig = {
          from: idA,
          to: idB,
          color: { color: 'grey' },
          dashes: false,
          width: 2
        };
      } else {
        // Parent or Love link: red dashed
        edgeConfig = {
          from: idA,
          to: idB,
          color: { color: 'red' },
          dashes: true,
          width: 2
        };
      }

      edges.add(edgeConfig);

      // clear inputs
      document.getElementById('nameA').value = '';
      document.getElementById('nameB').value = '';
    }
  </script>

</body>
</html>
