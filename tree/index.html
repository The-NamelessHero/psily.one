<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tree of Love â€“ Psily.one</title>
  <link rel="stylesheet" href="../style.css">

  <!-- vis-network CSS & JS -->
  <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet" />
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

  <style>
    body {
      margin:0; padding:1em;
      background: #1a0f1f;
      color: #f8e1ff;
      font-family: Georgia, serif;
    }
    header { text-align:center; margin-bottom:1em; }
    nav a, nav button {
      margin:0 1em;
      color:#b892ff;
      text-decoration:none;
      background:none; border:none;
      font:inherit; cursor:pointer;
    }
    #controls {
      display:flex; justify-content:center; gap:1em; margin-bottom:1em;
    }
    #controls input, #controls select, #controls button {
      padding:.5em 1em; border-radius:6px;
      border:1px solid #774da9; background:#2d1b3a; color:#fff3ff;
      font-size:1em;
    }
    #network {
      width:100%; height:70vh;
      border:2px solid #774da9; border-radius:8px;
      background:#2d1b3a;
    }
    footer { text-align:center; margin-top:1em; }
    footer a { color:#b892ff; text-decoration:none; }
  </style>
</head>
<body>

  <header>
    <nav>
      <a href="/">ğŸŒ€ Home</a>
      <a href="/scrolls/">âœï¸ Write a Scroll</a>
      <a href="/library/">ğŸ“š Library</a>
      <a href="/profile/">ğŸ‘¤ Profile</a>
      <button onclick="toggleDark()">ğŸŒ“</button>
    </nav>
    <h1>ğŸŒ³ Tree of Love</h1>
    <p>Click a node to select it, then add new family members below.</p>
  </header>

  <div id="controls">
    <select id="parentSelect">
      <option value="">â€” Select Parent â€”</option>
    </select>
    <input id="childInput" placeholder="New member nameâ€¦" />
    <button id="addBtn">â• Add</button>
  </div>

  <div id="network"></div>

  <footer>
    <a href="/">â† Back to Psily.one</a>
  </footer>

  <script>
    // Dark mode toggle
    function toggleDark() {
      document.body.classList.toggle('light-mode');
    }

    // 1) Prepare vis-network
    const container = document.getElementById('network');
    const nodes   = new vis.DataSet();
    const edges   = new vis.DataSet();
    let network;

    // 2) Your â€œrootâ€ node (e.g. pulled from login)
    const userName = prompt("Enter your name to start your Tree of Love") || "Anonymous";
    nodes.add({ id: userName, label: userName, color:{ background:'#ffde7d', border:'#c4a76f' }});

    // 3) Render function
    function draw() {
      // rebuild parent dropdown
      const parentSelect = document.getElementById('parentSelect');
      parentSelect.innerHTML = `<option value="">â€” Select Parent â€”</option>` +
        nodes.get().map(n => `<option value="${n.id}">${n.label}</option>`).join('');

      // destroy old if exists
      if (network) network.destroy();

      // create new
      network = new vis.Network(container, { nodes, edges }, {
        layout: {
          hierarchical: {
            direction: 'UD',    // up-down
            sortMethod: 'directed',
            nodeSpacing: 200,
            levelSeparation: 150
          }
        },
        interaction: {
          dragNodes: true,       // allow manual drag
          dragView: true,        // pan
          selectConnectedEdges: false
        },
        physics: {
          enabled: false         // no force simulation
        },
        nodes: {
          shape: 'dot',
          size: 24,
          font: { color:'#fff3ff', size:14 }
        },
        edges: {
          arrows: { to:{ enabled:false } },
          color: '#cfaaff',
          smooth: true,
          width: 2
        }
      });

      // center on user
      network.once('afterDrawing', () => {
        network.focus(userName, { scale:1.2, animation:{ duration:600 } });
      });
    }

    // 4) Add button handler
    document.getElementById('addBtn').onclick = () => {
      const parent = document.getElementById('parentSelect').value;
      const child  = document.getElementById('childInput').value.trim();
      if (!parent) return alert("Please select a parent node first.");
      if (!child)  return alert("Please enter a name for the new member.");

      if (!nodes.get(child)) {
        nodes.add({ id: child, label: child });
        edges.add({ from: parent, to: child });
        draw();
        document.getElementById('childInput').value = '';
      } else {
        alert("That name already exists in your tree.");
      }
    };

    // 5) Initial draw
    draw();
  </script>
</body>
</html>
