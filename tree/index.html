<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tree of Love â€“ Psily.one</title>
  <link rel="stylesheet" href="../style.css">
  <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet" />
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <style>
    body {
      margin: 0; padding: 1em;
      background: #1a0f1f;
      color: #f8e1ff;
      font-family: Georgia, serif;
    }
    header { text-align: center; margin-bottom: 1em; }
    nav a, nav button {
      margin: 0 1em;
      color: #b892ff;
      text-decoration: none;
      background: none;
      border: none;
      font: inherit;
      cursor: pointer;
    }
    .controls {
      text-align: center;
      margin-bottom: 1em;
    }
    .controls input,
    .controls select,
    .controls button {
      margin: 0 .5em;
      padding: .5em;
      border-radius: 4px;
      border: 1px solid #774da9;
      background: #1e1127;
      color: #fff3ff;
      font: inherit;
    }
    #network {
      width: 100%; height: 75vh;
      border: 2px solid #774da9;
      border-radius: 8px;
      background: #2d1b3a;
    }
    footer { text-align: center; margin-top: 1em; }
    footer a { color: #b892ff; text-decoration: none; }
  </style>
</head>
<body>

  <header>
    <nav>
      <a href="/">ğŸŒ€ Home</a>
      <a href="/scrolls/">âœï¸ Write a Scroll</a>
      <a href="/library/">ğŸ›ï¸ Library</a>
      <a href="/profile/">ğŸ‘¤ Profile</a>
    </nav>
    <h1>ğŸŒ³ Tree of Love</h1>
    <p>Block-style nodes with red dashed â€œloveâ€ links.</p>
  </header>

  <div class="controls">
    <input id="newName" placeholder="Your Name or Alias" />
    <select id="relationType">
      <option value="parent">ğŸ‘ª Parent of</option>
      <option value="child">ğŸ‘¶ Child of</option>
      <option value="love">â¤ï¸ Loves</option>
    </select>
    <input id="targetName" placeholder="Targetâ€™s Name or Alias" />
    <button onclick="addRelation()">Add Relation</button>
  </div>

  <div id="network"></div>

  <footer>
    <a href="/">â† Back to Psily.one</a>
  </footer>

  <script>
    function toggleDark(){
      document.body.classList.toggle('light-mode');
    }

    // 1) Nodes with blank labels for manual fill-in
    const nodesDS = new vis.DataSet([
      { id: 1, label: '' },
      { id: 2, label: '' },
      { id: 3, label: '' },
      { id: 4, label: '' },
      { id: 5, label: '' },
      { id: 6, label: '' },
      { id: 7, label: '' },
      { id: 8, label: '' }
    ]);

    // 2) Edges: no arrows, just straight lines
    const edgesDS = new vis.DataSet([
      // family links (solid purple)
      { from:1, to:3, color:{ color:'#cfaaff' }, dashes:false, width:2 },
      { from:1, to:4, color:{ color:'#cfaaff' }, dashes:false, width:2 },
      { from:1, to:5, color:{ color:'#cfaaff' }, dashes:false, width:2 },
      { from:1, to:6, color:{ color:'#cfaaff' }, dashes:false, width:2 },
      { from:2, to:3, color:{ color:'#cfaaff' }, dashes:false, width:2 },
      { from:2, to:4, color:{ color:'#cfaaff' }, dashes:false, width:2 },
      { from:2, to:5, color:{ color:'#cfaaff' }, dashes:false, width:2 },
      { from:2, to:6, color:{ color:'#cfaaff' }, dashes:false, width:2 },
      // love links (red dashed)
      { from:4, to:7, color:{ color:'red' }, dashes:true, width:3 },
      { from:4, to:8, color:{ color:'red' }, dashes:true, width:3 }
    ]);

    // 3) Initialize vis-network with box nodes
    const container = document.getElementById('network');
    const data = { nodes: nodesDS, edges: edgesDS };
    const options = {
      nodes: {
        shape: 'box',
        margin: 10,
        widthConstraint: { maximum: 200 }
      },
      layout: {
        hierarchical: {
          enabled: true,
          direction: 'UD',
          sortMethod: 'directed',
          nodeSpacing: 200,
          levelSeparation: 150
        }
      },
      interaction: {
        dragNodes: true,
        dragView: true,
        zoomView: true
      },
      physics: { enabled: false }
    };
    const network = new vis.Network(container, data, options);

    // 4) Dynamic addRelation()
    function addRelation() {
      const name = document.getElementById('newName').value.trim();
      const target = document.getElementById('targetName').value.trim();
      const type = document.getElementById('relationType').value;
      if (!name || !target) {
        return alert('Please fill in both names.');
      }

      function getNodeId(label) {
        const existing = nodesDS.get().find(n => n.label === label);
        if (existing) return existing.id;
        const newId = Math.max(...nodesDS.get().map(n => n.id)) + 1;
        nodesDS.add({ id: newId, label: '' });
        return newId;
      }

      const sourceId = getNodeId(name);
      const targetId = getNodeId(target);

      let edge;
      if (type === 'parent') {
        edge = { from: sourceId, to: targetId, color:{color:'#cfaaff'}, dashes:false, width:2 };
      } else if (type === 'child') {
        edge = { from: sourceId, to: targetId, color:{color:'#cfaaff'}, dashes:false, width:2 };
      } else { // love
        edge = { from: sourceId, to: targetId, color:{color:'red'}, dashes:true, width:3 };
      }

      edgesDS.add(edge);
      document.getElementById('newName').value = '';
      document.getElementById('targetName').value = '';
    }
  </script>

</body>
</html>
