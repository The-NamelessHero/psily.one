<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tree of Love ‚Äì Psily.one</title>
  <link rel="stylesheet" href="../style.css">
  <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet" />
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
  <style>
    body {
      margin: 0; padding: 1em;
      background: #1a0f1f;
      color: #f8e1ff;
      font-family: Georgia, serif;
    }
    header { text-align: center; margin-bottom: 1em; }
    nav a, nav button {
      margin: 0 1em;
      color: #b892ff;
      text-decoration: none;
      background: none;
      border: none;
      font: inherit;
      cursor: pointer;
    }
    .controls {
      text-align: center;
      margin-bottom: 1em;
    }
    .controls input,
    .controls select,
    .controls button {
      margin: 0 .5em;
      padding: .5em;
      border-radius: 4px;
      border: 1px solid #774da9;
      background: #1e1127;
      color: #fff3ff;
      font: inherit;
    }
    #network {
      width: 100%; height: 75vh;
      border: 2px solid #774da9;
      border-radius: 8px;
      background: #2d1b3a;
    }
    footer { text-align: center; margin-top: 1em; }
    footer a { color: #b892ff; text-decoration: none; }
  </style>
</head>
<body>

  <header>
    <nav>
      <a href="/">üåÄ Home</a>
      <a href="/scrolls/">‚úçÔ∏è Write a Scroll</a>
      <a href="/library/">üèõÔ∏è Library</a>
      <a href="/profile/">üë§ Profile</a>
    </nav>
    <h1>üå≥ Tree of Love</h1>
    <p>A block-style family tree with red ‚Äúlove‚Äù links.</p>
  </header>

  <div class="controls">
    <input id="newName" placeholder="Your Name or Alias" />
    <select id="relationType">
      <option value="parent">üë™ Parent of</option>
      <option value="child">üë∂ Child of</option>
      <option value="love">‚ù§Ô∏è Loves</option>
    </select>
    <input id="targetName" placeholder="Target‚Äôs Name or Alias" />
    <button onclick="addRelation()">Add Relation</button>
  </div>

  <div id="network"></div>

  <footer>
    <a href="/">‚Üê Back to Psily.one</a>
  </footer>

  <script>
    function toggleDark(){
      document.body.classList.toggle('light-mode');
    }

    // 1) Initial nodes & edges
    const nodesDS = new vis.DataSet([
      { id:1, label:'Ronald'    },
      { id:2, label:'Catherine' },
      { id:3, label:'Joshua'    },
      { id:4, label:'Justin'    },
      { id:5, label:'Jennifer'  },
      { id:6, label:'Jacob'     },
      { id:7, label:'Samantha'  },
      { id:8, label:'Kristina'  }
    ]);
    const edgesDS = new vis.DataSet([
      // parent‚Üíchild
      { from:1,to:3, arrows:'to', color:{color:'#cfaaff'}, smooth:{type:'straight'}, width:2 },
      { from:1,to:4, arrows:'to', color:{color:'#cfaaff'}, smooth:{type:'straight'}, width:2 },
      { from:1,to:5, arrows:'to', color:{color:'#cfaaff'}, smooth:{type:'straight'}, width:2 },
      { from:1,to:6, arrows:'to', color:{color:'#cfaaff'}, smooth:{type:'straight'}, width:2 },
      { from:2,to:3, arrows:'to', color:{color:'#cfaaff'}, smooth:{type:'straight'}, width:2 },
      { from:2,to:4, arrows:'to', color:{color:'#cfaaff'}, smooth:{type:'straight'}, width:2 },
      { from:2,to:5, arrows:'to', color:{color:'#cfaaff'}, smooth:{type:'straight'}, width:2 },
      { from:2,to:6, arrows:'to', color:{color:'#cfaaff'}, smooth:{type:'straight'}, width:2 },
      // love links
      { from:4,to:7, dashes:true, color:{color:'red'}, width:3, arrows:'' },
      { from:4,to:8, dashes:true, color:{color:'red'}, width:3, arrows:'' }
    ]);

    // 2) Initialize network with global box shape
    const container = document.getElementById('network');
    const data = { nodes: nodesDS, edges: edgesDS };
    const options = {
      nodes: {
        shape: 'box',
        margin: 10,
        widthConstraint: { maximum: 200 }
      },
      layout: {
        hierarchical: {
          enabled: true,
          direction: 'UD',
          sortMethod: 'directed',
          nodeSpacing: 200,
          levelSeparation: 150
        }
      },
      interaction: {
        dragNodes: true,
        dragView: true,
        zoomView: true
      },
      physics: { enabled: false }
    };
    const network = new vis.Network(container, data, options);

    // 3) Dynamic addRelation()
    function addRelation() {
      const name = document.getElementById('newName').value.trim();
      const target = document.getElementById('targetName').value.trim();
      const type = document.getElementById('relationType').value;
      if (!name || !target) {
        return alert('Please fill in both names.');
      }

      // Helper to find or create a node
      function getNodeId(label) {
        const existing = nodesDS.get().find(n => n.label === label);
        if (existing) return existing.id;
        const newId = Math.max(...nodesDS.get().map(n => n.id)) + 1;
        nodesDS.add({ id: newId, label, shape: 'box' });
        return newId;
      }

      const sourceId = getNodeId(name);
      const targetId = getNodeId(target);

      // Build edge config
      let edge = { from: sourceId, to: targetId };
      if (type === 'child') {
        edge = { from: sourceId, to: targetId, arrows:'to', color:{color:'#cfaaff'}, dashes:false, width:2 };
      } else if (type === 'parent') {
        edge = { from: targetId, to: sourceId, arrows:'to', color:{color:'#cfaaff'}, dashes:false, width:2 };
      } else if (type === 'love') {
        edge = { from: sourceId, to: targetId, dashes:true, color:{color:'red'}, width:3, arrows:'' };
      }

      edgesDS.add(edge);
      // Clear inputs
      document.getElementById('newName').value = '';
      document.getElementById('targetName').value = '';
    }
  </script>

</body>
</html>
