<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tree of Love ‚Äì Psily.one</title>
  <link rel="stylesheet" href="../style.css">

  <!-- vis-network CSS & JS -->
  <link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet" />
  <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

  <style>
    body {
      margin:0; padding:1em;
      background: #1a0f1f;
      color: #f8e1ff;
      font-family: Georgia, serif;
      transition: background .3s, color .3s;
    }
    body.light-mode {
      background: #f4f4f4;
      color: #222;
    }
    header { text-align:center; margin-bottom:1em; }
    nav a, nav button {
      margin:0 1em; color:#b892ff;
      text-decoration:none; background:none; border:none;
      font:inherit; cursor:pointer;
    }
    #controls {
      display:flex; justify-content:center; gap:1em; margin-bottom:1em;
    }
    #controls input, #controls select, #controls button {
      padding:.5em 1em; border-radius:6px;
      border:1px solid #774da9; background:#2d1b3a; color:#fff3ff;
      font-size:1em; transition: background .3s, color .3s;
    }
    body.light-mode #controls input,
    body.light-mode #controls select,
    body.light-mode #controls button {
      background: #fff; color: #222; border-color: #ccc;
    }
    #network {
      width:100%; height:70vh;
      border:2px solid #774da9; border-radius:8px;
      background:#2d1b3a;
      transition: background .3s;
    }
    body.light-mode #network {
      background: #fafafa;
    }
    footer { text-align:center; margin-top:1em; }
    footer a { color:#b892ff; text-decoration:none; }

    /* Optional: Vis.js overrides for light-mode boxes */
    body.light-mode .vis-network .vis-node {
      background-color: #ddd7ab !important;
      border-color: #c4b091 !important;
      color: #222 !important;
    }
  </style>
</head>
<body>

  <header>
    <nav>
      <a href="/">üåÄ Home</a>
      <a href="/scrolls/">‚úçÔ∏è Write a Scroll</a>
      <a href="/library/">üèõÔ∏è Library</a>
      <a href="/profile/">üë§ Profile</a>
      <button onclick="toggleDark()">üåì</button>
    </nav>
    <h1>üå≥ Tree of Love</h1>
    <p>Select a parent, add a child‚Äîand watch your family tree grow.</p>
  </header>

  <div id="controls">
    <select id="parentSelect">
      <option value="">‚Äî Select Parent ‚Äî</option>
    </select>
    <input id="childInput" placeholder="New member name‚Ä¶" />
    <button id="addBtn">‚ûï Add</button>
  </div>

  <div id="network"></div>

  <footer>
    <a href="/">‚Üê Back to Psily.one</a>
  </footer>

  <script>
    // Dark/light toggle
    function toggleDark() {
      document.body.classList.toggle('light-mode');
    }

    // 1) Setup vis-data
    const container = document.getElementById('network');
    const nodes     = new vis.DataSet();
    const edges     = new vis.DataSet();
    let network;

    // 2) Prompt root node
    const userName = prompt("Enter your name to start your Tree of Love") || "Anonymous";
    nodes.add({
      id: userName,
      label: userName,
      shape: 'box',
      color: { background:'#ffde7d', border:'#c4a76f' },
      font:  { color:'#1a0f1f', size:16 },
      margin: { top:8, bottom:8, left:12, right:12 }
    });

    // 3) Draw function
    function draw() {
      // Rebuild parent dropdown
      const parentSelect = document.getElementById('parentSelect');
      parentSelect.innerHTML = '<option value="">‚Äî Select Parent ‚Äî</option>' +
        nodes.get().map(n => `<option value="${n.id}">${n.label}</option>`).join('');

      // Destroy old network
      if (network) network.destroy();

      // Create new network
      network = new vis.Network(container, { nodes, edges }, {
        layout: {
          hierarchical: {
            enabled: true,
            direction: 'UD',
            sortMethod: 'directed',
            levelSeparation: 150,
            nodeSpacing: 200
          }
        },
        interaction: {
          dragNodes: true,
          dragView: true,
          zoomView: true
        },
        physics: { enabled: false },
        nodes: {
          shape: 'box',
          margin: { top:8, bottom:8, left:12, right:12 },
          font: { color:'#fff3ff', size:16 },
          color: { background:'#774da9', border:'#b892ff' }
        },
        edges: {
          color: '#cfaaff',
          width: 2,
          smooth: { type:'cubicBezier', forceDirection:'vertical', roundness:0.4 }
        }
      });

      // Center on the root user node
      network.once('afterDrawing', () => {
        network.focus(userName, { scale:1.2, animation:{ duration:600 } });
      });
    }

    // 4) Add new member
    document.getElementById('addBtn').onclick = () => {
      const parent = document.getElementById('parentSelect').value;
      const child  = document.getElementById('childInput').value.trim();
      if (!parent) alert("Please select a parent node first.");
      else if (!child) alert("Enter the child's name.");
      else if (nodes.get(child)) alert("That name already exists.");
      else {
        nodes.add({
          id: child,
          label: child,
          shape: 'box',
          margin: { top:8, bottom:8, left:12, right:12 }
        });
        edges.add({ from: parent, to: child });
        document.getElementById('childInput').value = '';
        draw();
      }
    };

    // 5) Initial draw
    draw();
  </script>
</body>
</html>
